---
- name: Shutdown the VM using SNOW variable
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Shutdown the VM
      community.vmware.vmware_guest_powerstate:
         name: xf-s-aapwin04t
    #     name: "{{ variables.server }}"
         state: shutdown-guest
          register: shutdown_result

    - name: Fail if server is already shut down
      fail:
        msg: "Server is already shut down state"
      when: shutdown_result.status == "shutdown" or not shutdown_result.changed
